<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Parminder Singh">
<meta name="dcterms.date" content="2026-01-01">

<title>Task 4: Animation with gganimate – Data Visualisation e-Portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-de84f8d6bb715db06a919283c2d1e787.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-4d01e6e8a406b62be36f5785d81e4bf1.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Data Visualisation e-Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../tasks/01-spec.html"> 
<span class="menu-text">Task 1: SPEC</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../tasks/02-grammar-of-graphics.html"> 
<span class="menu-text">Task 2: Grammar of Graphics</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../tasks/03-complex-graphics.html"> 
<span class="menu-text">Task 3: Complex Graphics</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../tasks/04-animation.html" aria-current="page"> 
<span class="menu-text">Task 4: Animation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../tasks/about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#animation-principles-in-the-grammar-of-graphics" id="toc-animation-principles-in-the-grammar-of-graphics" class="nav-link" data-scroll-target="#animation-principles-in-the-grammar-of-graphics">Animation Principles in the Grammar of Graphics</a>
  <ul class="collapse">
  <li><a href="#frame-as-an-aesthetic" id="toc-frame-as-an-aesthetic" class="nav-link" data-scroll-target="#frame-as-an-aesthetic">1. <strong>Frame as an Aesthetic</strong></a></li>
  <li><a href="#temporal-continuity" id="toc-temporal-continuity" class="nav-link" data-scroll-target="#temporal-continuity">2. <strong>Temporal Continuity</strong></a></li>
  <li><a href="#narrative-flow" id="toc-narrative-flow" class="nav-link" data-scroll-target="#narrative-flow">3. <strong>Narrative Flow</strong></a></li>
  </ul></li>
  <li><a href="#animation-1-life-expectancy-vs.-gdp-per-capita-over-time" id="toc-animation-1-life-expectancy-vs.-gdp-per-capita-over-time" class="nav-link" data-scroll-target="#animation-1-life-expectancy-vs.-gdp-per-capita-over-time">Animation 1: Life Expectancy vs.&nbsp;GDP per Capita Over Time</a>
  <ul class="collapse">
  <li><a href="#design-rationale" id="toc-design-rationale" class="nav-link" data-scroll-target="#design-rationale">Design Rationale</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation">Implementation</a></li>
  <li><a href="#grammar-of-graphics-animation-components" id="toc-grammar-of-graphics-animation-components" class="nav-link" data-scroll-target="#grammar-of-graphics-animation-components">Grammar of Graphics + Animation Components</a></li>
  <li><a href="#narrative-interpretation" id="toc-narrative-interpretation" class="nav-link" data-scroll-target="#narrative-interpretation">Narrative Interpretation</a></li>
  </ul></li>
  <li><a href="#animation-2-regional-spotlight-sub-saharan-africa-and-the-hivaids-crisis" id="toc-animation-2-regional-spotlight-sub-saharan-africa-and-the-hivaids-crisis" class="nav-link" data-scroll-target="#animation-2-regional-spotlight-sub-saharan-africa-and-the-hivaids-crisis">Animation 2: Regional Spotlight – Sub-Saharan Africa and the HIV/AIDS Crisis</a>
  <ul class="collapse">
  <li><a href="#design-rationale-1" id="toc-design-rationale-1" class="nav-link" data-scroll-target="#design-rationale-1">Design Rationale</a></li>
  <li><a href="#implementation-1" id="toc-implementation-1" class="nav-link" data-scroll-target="#implementation-1">Implementation</a></li>
  <li><a href="#grammar-of-graphics-animation-components-1" id="toc-grammar-of-graphics-animation-components-1" class="nav-link" data-scroll-target="#grammar-of-graphics-animation-components-1">Grammar of Graphics + Animation Components</a></li>
  <li><a href="#narrative-interpretation-1" id="toc-narrative-interpretation-1" class="nav-link" data-scroll-target="#narrative-interpretation-1">Narrative Interpretation</a></li>
  </ul></li>
  <li><a href="#animation-3-global-progress-animated-bar-chart-race" id="toc-animation-3-global-progress-animated-bar-chart-race" class="nav-link" data-scroll-target="#animation-3-global-progress-animated-bar-chart-race">Animation 3: Global Progress – Animated Bar Chart Race</a>
  <ul class="collapse">
  <li><a href="#design-rationale-2" id="toc-design-rationale-2" class="nav-link" data-scroll-target="#design-rationale-2">Design Rationale</a></li>
  <li><a href="#implementation-2" id="toc-implementation-2" class="nav-link" data-scroll-target="#implementation-2">Implementation</a></li>
  <li><a href="#grammar-of-graphics-animation-components-2" id="toc-grammar-of-graphics-animation-components-2" class="nav-link" data-scroll-target="#grammar-of-graphics-animation-components-2">Grammar of Graphics + Animation Components</a></li>
  <li><a href="#narrative-interpretation-2" id="toc-narrative-interpretation-2" class="nav-link" data-scroll-target="#narrative-interpretation-2">Narrative Interpretation</a></li>
  </ul></li>
  <li><a href="#reflective-commentary-how-animation-alters-perception" id="toc-reflective-commentary-how-animation-alters-perception" class="nav-link" data-scroll-target="#reflective-commentary-how-animation-alters-perception">Reflective Commentary: How Animation Alters Perception</a>
  <ul class="collapse">
  <li><a href="#advantages-of-animation" id="toc-advantages-of-animation" class="nav-link" data-scroll-target="#advantages-of-animation">Advantages of Animation</a></li>
  <li><a href="#limitations-and-risks" id="toc-limitations-and-risks" class="nav-link" data-scroll-target="#limitations-and-risks">Limitations and Risks</a></li>
  <li><a href="#when-animation-works-best" id="toc-when-animation-works-best" class="nav-link" data-scroll-target="#when-animation-works-best">When Animation Works Best</a></li>
  </ul></li>
  <li><a href="#implementation-notes" id="toc-implementation-notes" class="nav-link" data-scroll-target="#implementation-notes">Implementation Notes</a>
  <ul class="collapse">
  <li><a href="#quarto-integration" id="toc-quarto-integration" class="nav-link" data-scroll-target="#quarto-integration">Quarto Integration</a></li>
  <li><a href="#performance-considerations" id="toc-performance-considerations" class="nav-link" data-scroll-target="#performance-considerations">Performance Considerations</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Task 4: Animation with gganimate</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Parminder Singh </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 1, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p><strong>Animation</strong> extends the Grammar of Graphics into the temporal domain, adding a fourth dimension to static visualisations. Where static plots show relationships <em>at one moment in time</em>, animations reveal <strong>change, evolution, and causality</strong> across sequences.</p>
<p>This task creates a <strong>Gapminder-style animation</strong> using the <code>gapminder</code> dataset, which tracks life expectancy, GDP per capita, and population across 184 countries from 1952 to 2007. We will reveal how global inequality in health and wealth has evolved, with particular attention to the impact of the HIV/AIDS crisis on sub-Saharan African nations.</p>
<p>The key narrative: <strong>Despite overall progress, regional inequality and epidemic crises create divergent trajectories.</strong></p>
<hr>
</section>
<section id="animation-principles-in-the-grammar-of-graphics" class="level2">
<h2 class="anchored" data-anchor-id="animation-principles-in-the-grammar-of-graphics">Animation Principles in the Grammar of Graphics</h2>
<p>In the Grammar of Graphics extended to animation <span class="citation" data-cites="heer2010 matejka2016">(<a href="#ref-heer2010" role="doc-biblioref">Heer and Bostock 2010</a>; <a href="#ref-matejka2016" role="doc-biblioref">Matejka, Fitzmaurice, and Kurtenbach 2016</a>)</span>, animation introduces:</p>
<section id="frame-as-an-aesthetic" class="level3">
<h3 class="anchored" data-anchor-id="frame-as-an-aesthetic">1. <strong>Frame as an Aesthetic</strong></h3>
<p>Animation treats time (or sequence) as another dimension, akin to colour, size, or position. Each frame is a complete instantiation of the graphical specification.</p>
</section>
<section id="temporal-continuity" class="level3">
<h3 class="anchored" data-anchor-id="temporal-continuity">2. <strong>Temporal Continuity</strong></h3>
<p>Smooth transitions between frames create the illusion of continuous motion, allowing the eye to track individual elements and perceive trajectories.</p>
</section>
<section id="narrative-flow" class="level3">
<h3 class="anchored" data-anchor-id="narrative-flow">3. <strong>Narrative Flow</strong></h3>
<p>The sequence of frames guides the audience through a story: exposition → development → climax → reflection.</p>
<hr>
</section>
</section>
<section id="animation-1-life-expectancy-vs.-gdp-per-capita-over-time" class="level2">
<h2 class="anchored" data-anchor-id="animation-1-life-expectancy-vs.-gdp-per-capita-over-time">Animation 1: Life Expectancy vs.&nbsp;GDP per Capita Over Time</h2>
<section id="design-rationale" class="level3">
<h3 class="anchored" data-anchor-id="design-rationale">Design Rationale</h3>
<p>This animation mimics the classic Gapminder visualization popularised by Hans Rosling <span class="citation" data-cites="rosling2018">(<a href="#ref-rosling2018" role="doc-biblioref">Rosling and Rosling Rönnlund 2018</a>)</span>:</p>
<ul>
<li><strong>x-axis</strong>: GDP per capita (log scale, to compress extreme range)</li>
<li><strong>y-axis</strong>: Life expectancy (linear scale)</li>
<li><strong>size</strong>: Population (perceptual scale)</li>
<li><strong>colour</strong>: Continent (categorical distinction)</li>
<li><strong>animation</strong>: Year (1952–2007)</li>
</ul>
<p>The log scale on GDP is critical: it reflects the intuition that doubling income matters more when you’re poor (linear wealth increase from $1k to $2k) than when you’re rich (linear increase from $20k to $21k). Logarithmic scaling makes these differences perceptually equivalent.</p>
</section>
<section id="implementation" class="level3">
<h3 class="anchored" data-anchor-id="implementation">Implementation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Animation 1: Classic Gapminder-style scatter</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>anim1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  gapminder,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> gdpPercap,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> lifeExp,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> pop,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> continent,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> year  <span class="co"># Frame aesthetic for animation</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"GDP per Capita (USD, log scale)"</span>,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">dollar_format</span>()</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Life Expectancy (years)"</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">90</span>),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">25</span>, <span class="dv">90</span>, <span class="dv">10</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Population"</span>,</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">scale =</span> <span class="fl">1e-6</span>, <span class="at">suffix =</span> <span class="st">"M"</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_brewer</span>(</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"Dark2"</span>,</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Continent"</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Global Health and Wealth Trajectories"</span>,</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Year: {closest_state}"</span>,  <span class="co"># Dynamic subtitle showing current year</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Size = population; colour = continent. Data: Gapminder (1952–2007)"</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># gganimate specification</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_states</span>(year, <span class="at">transition_length =</span> <span class="dv">1</span>, <span class="at">state_length =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ease_aes</span>(<span class="st">"cubic-in-out"</span>) <span class="sc">+</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enter_fade</span>() <span class="sc">+</span>  <span class="co"># Points fade in</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exit_fade</span>()    <span class="co"># Points fade out</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Render the animation (run in R/RStudio interactive session)</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="co"># animate(anim1, nframes = 112, fps = 2, width = 800, height = 600, renderer = av_renderer())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="grammar-of-graphics-animation-components" class="level3">
<h3 class="anchored" data-anchor-id="grammar-of-graphics-animation-components">Grammar of Graphics + Animation Components</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 42%">
<col style="width: 57%">
</colgroup>
<thead>
<tr class="header">
<th>Component</th>
<th>Specification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Data</strong></td>
<td><code>gapminder</code> (1,704 observations; 6 variables)</td>
</tr>
<tr class="even">
<td><strong>Aesthetics</strong></td>
<td>x = gdpPercap, y = lifeExp, size = pop, colour = continent, <strong>frame = year</strong></td>
</tr>
<tr class="odd">
<td><strong>Geometry</strong></td>
<td><code>geom_point()</code></td>
</tr>
<tr class="even">
<td><strong>Stat</strong></td>
<td><code>stat_identity()</code></td>
</tr>
<tr class="odd">
<td><strong>Scales</strong></td>
<td>Log10 (x), linear (y), continuous (size), categorical (colour)</td>
</tr>
<tr class="even">
<td><strong>Coordinates</strong></td>
<td>Cartesian</td>
</tr>
<tr class="odd">
<td><strong>Guides</strong></td>
<td>Title, axis labels, legends</td>
</tr>
<tr class="even">
<td><strong>Animation</strong></td>
<td><strong><code>transition_states(year)</code></strong> – frame by year; <code>ease_aes()</code> – smooth transitions</td>
</tr>
</tbody>
</table>
</section>
<section id="narrative-interpretation" class="level3">
<h3 class="anchored" data-anchor-id="narrative-interpretation">Narrative Interpretation</h3>
<p>What the animation reveals:</p>
<ol type="1">
<li><p><strong>General convergence</strong>: Over 55 years, many nations move rightward (higher GDP) and upward (higher life expectancy).</p></li>
<li><p><strong>Persistent inequality</strong>: Despite progress, the spread between rich (rightmost) and poor (leftmost) nations increases absolutely, though relative inequality may decrease.</p></li>
<li><p><strong>Regional clusters</strong>: Nations group by continent, with Africa generally lagging, Europe leading.</p></li>
<li><p><strong>Outliers and crises</strong>: Individual countries’ trajectories reveal specific events:</p>
<ul>
<li><strong>China &amp; India</strong>: Steep upward-rightward arrows from the 1990s onward (economic liberalisation).</li>
<li><strong>Rwanda, Lesotho, Zimbabwe</strong>: Plateau or decline in life expectancy (1990s–2000s) due to HIV/AIDS.</li>
<li><strong>Japan &amp; Korea</strong>: Steady progress to the top-right corner.</li>
</ul></li>
</ol>
<hr>
</section>
</section>
<section id="animation-2-regional-spotlight-sub-saharan-africa-and-the-hivaids-crisis" class="level2">
<h2 class="anchored" data-anchor-id="animation-2-regional-spotlight-sub-saharan-africa-and-the-hivaids-crisis">Animation 2: Regional Spotlight – Sub-Saharan Africa and the HIV/AIDS Crisis</h2>
<section id="design-rationale-1" class="level3">
<h3 class="anchored" data-anchor-id="design-rationale-1">Design Rationale</h3>
<p>The global view masks regional tragedies. This animation <strong>zooms into Sub-Saharan Africa</strong>, showing the devastating impact of HIV/AIDS (1985–2005) and early signs of recovery.</p>
<p>We use: - <strong>Colour gradient</strong> (instead of points) to show GDP per capita - <strong>y-axis trajectory</strong> to show life expectancy over time - <strong>Faceting</strong> by region within Africa to isolate patterns</p>
<p>This demonstrates how <strong>narrative framing</strong> (choosing what to show) shapes audience interpretation.</p>
</section>
<section id="implementation-1" class="level3">
<h3 class="anchored" data-anchor-id="implementation-1">Implementation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare Africa-focused data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>africa_data <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">"Africa"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>      country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"South Africa"</span>, <span class="st">"Botswana"</span>, <span class="st">"Lesotho"</span>, <span class="st">"Mozambique"</span>, <span class="st">"Zambia"</span>, <span class="st">"Zimbabwe"</span>) <span class="sc">~</span> <span class="st">"Southern Africa"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>      country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Kenya"</span>, <span class="st">"Uganda"</span>, <span class="st">"Tanzania"</span>, <span class="st">"Rwanda"</span>) <span class="sc">~</span> <span class="st">"East Africa"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>      country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Nigeria"</span>, <span class="st">"Ghana"</span>, <span class="st">"Senegal"</span>, <span class="st">"Côte d'Ivoire"</span>) <span class="sc">~</span> <span class="st">"West Africa"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other Africa"</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Animation 2: Africa-focused, with emphasis on HIV/AIDS impact</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>anim2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  africa_data,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> year,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> lifeExp,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> gdpPercap,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> pop,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> year</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> country), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>region, <span class="at">nrow =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Year"</span>,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1952</span>, <span class="dv">2007</span>, <span class="dv">10</span>)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Life Expectancy (years)"</span>,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">80</span>),</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">30</span>, <span class="dv">80</span>, <span class="dv">10</span>)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_c</span>(</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"GDP per Capita"</span>,</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">dollar_format</span>()</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Population"</span>,</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">8</span>),</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">scale =</span> <span class="fl">1e-6</span>, <span class="at">suffix =</span> <span class="st">"M"</span>),</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="st">"none"</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"HIV/AIDS and Health Crisis in Sub-Saharan Africa"</span>,</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Trajectories across regions, 1952–2007"</span>,</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Colour = GDP per capita; line = country trajectory; visible dips in the 1990s–2000s reflect HIV/AIDS impact"</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Animation: reveal year by year</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_reveal</span>(year) <span class="sc">+</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ease_aes</span>(<span class="st">"linear"</span>)</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Render the animation (run in R/RStudio interactive session)</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="co"># animate(anim2, nframes = 112, fps = 2, width = 1000, height = 600, renderer = av_renderer())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="grammar-of-graphics-animation-components-1" class="level3">
<h3 class="anchored" data-anchor-id="grammar-of-graphics-animation-components-1">Grammar of Graphics + Animation Components</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 42%">
<col style="width: 57%">
</colgroup>
<thead>
<tr class="header">
<th>Component</th>
<th>Specification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Data</strong></td>
<td><code>gapminder</code> filtered to Africa (52 countries)</td>
</tr>
<tr class="even">
<td><strong>Aesthetics</strong></td>
<td>x = year, y = lifeExp, colour = gdpPercap, size = pop, <strong>frame = year</strong></td>
</tr>
<tr class="odd">
<td><strong>Geometry</strong></td>
<td><code>geom_line()</code> (connecting points across years) + <code>geom_point()</code></td>
</tr>
<tr class="even">
<td><strong>Stat</strong></td>
<td><code>stat_identity()</code></td>
</tr>
<tr class="odd">
<td><strong>Scales</strong></td>
<td>Linear (x, y), Viridis (colour), continuous (size)</td>
</tr>
<tr class="even">
<td><strong>Coordinates</strong></td>
<td>Cartesian</td>
</tr>
<tr class="odd">
<td><strong>Faceting</strong></td>
<td><code>facet_wrap(~region)</code> – four African regions</td>
</tr>
<tr class="even">
<td><strong>Animation</strong></td>
<td><strong><code>transition_reveal(year)</code></strong> – progressively reveal each year’s data</td>
</tr>
</tbody>
</table>
</section>
<section id="narrative-interpretation-1" class="level3">
<h3 class="anchored" data-anchor-id="narrative-interpretation-1">Narrative Interpretation</h3>
<p>This animation reveals:</p>
<ol type="1">
<li><p><strong>Regional diversity</strong>: Southern Africa (where HIV/AIDS was most severe) shows distinct downward trends. West Africa shows steadier improvement. East Africa falls in between.</p></li>
<li><p><strong>The AIDS crisis</strong> (visible 1985–2005): In Southern Africa, life expectancy plateaus or declines—a visible “dip” in otherwise upward trajectories.</p></li>
<li><p><strong>Economic disparities</strong>: Countries with higher GDP (warmer colours) generally maintain higher life expectancy, but wealth does not guarantee health (Botswana and South Africa are relatively wealthy yet severely affected by HIV/AIDS).</p></li>
<li><p><strong>Recovery signals</strong>: By 2007, some trajectories begin to rise again (antiretroviral therapy rollout and behaviour change).</p></li>
</ol>
<hr>
</section>
</section>
<section id="animation-3-global-progress-animated-bar-chart-race" class="level2">
<h2 class="anchored" data-anchor-id="animation-3-global-progress-animated-bar-chart-race">Animation 3: Global Progress – Animated Bar Chart Race</h2>
<section id="design-rationale-2" class="level3">
<h3 class="anchored" data-anchor-id="design-rationale-2">Design Rationale</h3>
<p><strong>Bar chart races</strong> have become popular in data journalism. They create excitement by showing competition and relative movement.</p>
<p>This animation ranks the top 15 countries by life expectancy each year, showing:</p>
<ul>
<li>Which nations lead in health outcomes</li>
<li>How rankings shift as newcomers rise and leaders fall</li>
<li>The role of policy, investment, and crisis in health trajectories</li>
</ul>
</section>
<section id="implementation-2" class="level3">
<h3 class="anchored" data-anchor-id="implementation-2">Implementation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare top 15 countries by life expectancy each year</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>top_countries_by_year <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(lifeExp)) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank =</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">15</span>, <span class="dv">1</span>), <span class="at">times =</span> <span class="fu">n_distinct</span>(year))  <span class="co"># Rank within each year</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Animation 3: Bar chart race</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>anim3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  top_countries_by_year,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">reorder</span>(country, lifeExp),  <span class="co"># Order by life expectancy</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> lifeExp,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> continent,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> year</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"Set1"</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Continent"</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Life Expectancy (years)"</span>,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">85</span>),</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">85</span>, <span class="dv">10</span>)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span>  <span class="co"># Horizontal bars for readability</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 15 Countries by Life Expectancy"</span>,</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Year: {closest_state}"</span>,</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Country"</span>,</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Colour = continent. Rankings shift as nations improve health outcomes."</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Animation: transition between years</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_states</span>(year, <span class="at">transition_length =</span> <span class="dv">2</span>, <span class="at">state_length =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ease_aes</span>(<span class="st">"cubic-in-out"</span>) <span class="sc">+</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enter_grow</span>() <span class="sc">+</span>  <span class="co"># Bars grow in</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exit_shrink</span>()   <span class="co"># Bars shrink out</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Render the animation (run in R/RStudio interactive session)</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="co"># animate(anim3, nframes = 112, fps = 2, width = 900, height = 700, renderer = av_renderer())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="grammar-of-graphics-animation-components-2" class="level3">
<h3 class="anchored" data-anchor-id="grammar-of-graphics-animation-components-2">Grammar of Graphics + Animation Components</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 42%">
<col style="width: 57%">
</colgroup>
<thead>
<tr class="header">
<th>Component</th>
<th>Specification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Data</strong></td>
<td><code>gapminder</code> (top 15 countries per year)</td>
</tr>
<tr class="even">
<td><strong>Aesthetics</strong></td>
<td>x = country (reordered), y = lifeExp, fill = continent, <strong>frame = year</strong></td>
</tr>
<tr class="odd">
<td><strong>Geometry</strong></td>
<td><code>geom_col()</code> – vertical bars, rotated</td>
</tr>
<tr class="even">
<td><strong>Stat</strong></td>
<td><code>stat_identity()</code></td>
</tr>
<tr class="odd">
<td><strong>Scales</strong></td>
<td>Discrete (x), continuous (y), categorical (fill)</td>
</tr>
<tr class="even">
<td><strong>Coordinates</strong></td>
<td><strong><code>coord_flip()</code></strong> – horizontal bars</td>
</tr>
<tr class="odd">
<td><strong>Animation</strong></td>
<td><strong><code>transition_states(year)</code></strong> – flip between year rankings</td>
</tr>
</tbody>
</table>
</section>
<section id="narrative-interpretation-2" class="level3">
<h3 class="anchored" data-anchor-id="narrative-interpretation-2">Narrative Interpretation</h3>
<p>This animation shows:</p>
<ol type="1">
<li><p><strong>Consistency at the top</strong>: Japan, Switzerland, Australia, and other wealthy nations remain in the top 15 throughout.</p></li>
<li><p><strong>Rising stars</strong>: South Korea, China, and Costa Rica show dramatic climbs, reflecting investments in healthcare and economic development.</p></li>
<li><p><strong>Stagnation and decline</strong>: Some nations remain in lower rankings despite decades passing.</p></li>
<li><p><strong>Continental patterns</strong>: European nations dominate the top 15 throughout, though non-European countries increasingly break into the top ranks by 2007.</p></li>
</ol>
<hr>
</section>
</section>
<section id="reflective-commentary-how-animation-alters-perception" class="level2">
<h2 class="anchored" data-anchor-id="reflective-commentary-how-animation-alters-perception">Reflective Commentary: How Animation Alters Perception</h2>
<section id="advantages-of-animation" class="level3">
<h3 class="anchored" data-anchor-id="advantages-of-animation">Advantages of Animation</h3>
<ol type="1">
<li><p><strong>Causality and narrative</strong>: Showing change over time invites causal reasoning (“What caused this dip?” “Why did this country rise?”). Static plots make causality implicit; animation makes it explicit.</p></li>
<li><p><strong>Engagement and memorability</strong>: Movement captures attention; studies show audiences retain animated content better than static visualisations.</p></li>
<li><p><strong>Revealing trajectories</strong>: Animation lets us see individual entities (countries) move along paths, revealing non-linear patterns (e.g., plateaus, sudden shifts).</p></li>
<li><p><strong>Managing overplotting</strong>: Rather than showing all years simultaneously (which would be cluttered), animation reveals one frame at a time, simplifying the visual field.</p></li>
</ol>
</section>
<section id="limitations-and-risks" class="level3">
<h3 class="anchored" data-anchor-id="limitations-and-risks">Limitations and Risks</h3>
<ol type="1">
<li><p><strong>Transience</strong>: Viewers cannot scroll back to compare earlier frames; animation requires temporal memory.</p></li>
<li><p><strong>Control</strong>: Viewers cannot pause to study details (unless made interactive), and playback speed affects perception.</p></li>
<li><p><strong>Biased narrative</strong>: The choice of animation variable (which dimension is temporal) shapes interpretation. A different sequence might tell a different story.</p></li>
<li><p><strong>Overuse</strong>: Not all data benefit from animation. Simple comparisons (e.g., 3–4 years) are often clearer in static form.</p></li>
</ol>
</section>
<section id="when-animation-works-best" class="level3">
<h3 class="anchored" data-anchor-id="when-animation-works-best">When Animation Works Best</h3>
<ul>
<li><strong>Progressive revelation</strong>: Showing how distributions shift over many time points</li>
<li><strong>Tracking entities</strong>: Following individual countries/companies/populations as they move through space</li>
<li><strong>Demonstrating processes</strong>: Illustrating how algorithms work (e.g., k-means clustering) or how systems evolve (e.g., epidemics spreading)</li>
<li><strong>Storytelling</strong>: Guiding an audience through a narrative arc</li>
</ul>
<hr>
</section>
</section>
<section id="implementation-notes" class="level2">
<h2 class="anchored" data-anchor-id="implementation-notes">Implementation Notes</h2>
<section id="quarto-integration" class="level3">
<h3 class="anchored" data-anchor-id="quarto-integration">Quarto Integration</h3>
<p>In Quarto, animated graphics are rendered as <strong>GIFs</strong> or <strong>MP4s</strong> and embedded in the final HTML document. The workflow is:</p>
<ol type="1">
<li>Define the animation using <code>gganimate</code> syntax</li>
<li>Render the animation object using <code>animate()</code> within a code chunk</li>
<li>Quarto automatically handles conversion and embedding</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example (in a Quarto code chunk)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>my_animation <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(...) <span class="sc">+</span> <span class="fu">transition_states</span>(...) <span class="sc">+</span> <span class="fu">ease_aes</span>(...)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">animate</span>(my_animation, <span class="at">nframes =</span> <span class="dv">100</span>, <span class="at">fps =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="performance-considerations" class="level3">
<h3 class="anchored" data-anchor-id="performance-considerations">Performance Considerations</h3>
<ul>
<li><strong>Frame count</strong>: More frames (higher frame count) create smoother motion but larger file sizes.</li>
<li><strong>FPS (frames per second)</strong>: 2 fps is slow and contemplative; 10+ fps is fast and action-oriented.</li>
<li><strong>Resolution</strong>: Balance readability with file size; 800×600px is reasonable for web display.</li>
</ul>
<hr>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Animation extends the Grammar of Graphics to include <strong>time</strong> as a first-class dimension. By sequencing static plots and using smooth transitions, we can reveal:</p>
<ul>
<li><strong>Trends</strong>: How do variables change over time?</li>
<li><strong>Trajectories</strong>: Which individual entities follow which paths?</li>
<li><strong>Causal narratives</strong>: What events or policies explain observed changes?</li>
</ul>
<p>The three animations in this task demonstrate different narrative angles on the same underlying Gapminder dataset—a key insight: <strong>the same data can tell multiple stories depending on how we frame and visualise it</strong>.</p>
<p>In the final task, we integrate all components (SPEC, Grammar of Graphics, complex graphics, and animation) into a cohesive <strong>Quarto website</strong>, demonstrating that reproducible, academically rigorous data visualisation is not just a technical skill but a form of scholarship.</p>
<hr>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-heer2010" class="csl-entry" role="listitem">
Heer, Jeffrey, and Mike Bostock. 2010. <span>“Animated Transitions in Statistical Data Graphics.”</span> <em>IEEE Transactions on Visualization and Computer Graphics</em> 16 (6): 989–97.
</div>
<div id="ref-matejka2016" class="csl-entry" role="listitem">
Matejka, Justin, Gord Fitzmaurice, and Gordon Kurtenbach. 2016. <span>“Dynamic Ghosting: Enabling Interaction in Extremely High-Latency Applications,”</span> 161–72.
</div>
<div id="ref-rosling2018" class="csl-entry" role="listitem">
Rosling, Hans, and Anna Rosling Rönnlund. 2018. <em>Factfulness: Ten Reasons We’re Wrong about the World – and Why Things Are Better Than You Think</em>. Flatiron Books.
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>© 2025-2026 Data Visualisation Portfolio | Submitted to Harper Adams University</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>